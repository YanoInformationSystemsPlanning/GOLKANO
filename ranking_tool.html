<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>シフト調整</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    #grid {
      display: grid;
      grid-template-columns: repeat(32, 80px);
      margin: 10px auto;
      border-collapse: collapse;
    }
    #grid div {
      border: 1px solid #ccc;
      padding: 4px;
      box-sizing: border-box;
    }
    #version-label {
      text-align: left;
      margin: 10px;
      font-size: 0.8em;
      color: #555;
    }
    select, button {
      margin: 5px;
      padding: 5px 10px;
      font-size: 1em;
    }
    #message {
      margin: 5px;
      font-size: 0.9em;
      color: red;
    }
  </style>
</head>
<body>
  <h2>シフト調整</h2>
  <div>
    <label for="memberSelect">メンバー選択：</label>
    <select id="memberSelect"></select>
    <button onclick="loadDataForMember()">表示</button>
  </div>
  <div id="message"></div>
  <div class="grid" id="grid"></div>
  <div id="version-label">Ver.0 Rev.1</div>

  <script>
    const gasUrl = 'https://script.google.com/macros/s/AKfycbzCYQRN6hg9n8OERx11vJslBCvy0VmgO-nzMIryNO1gUD4Q1wim5srxDPCKsggYsMzf5g/exec';
    const folderId = '1P9IpgCw1L_cvKjemIpg3ygtOAOUePWZh';
    const inputFile = 'input_data.txt';
    let allData = [];

    const memberSelect = document.getElementById("memberSelect");
    const grid = document.getElementById("grid");
    const message = document.getElementById("message");

    // 起動時：1回だけ input_data.txt を読み込む
    window.onload = initAllData;

    async function initAllData() {
      try {
        const url = `${gasUrl}?action=read&folder=${folderId}&file=${inputFile}`;
        const response = await fetch(url);
        if (!response.ok) throw new Error(`HTTPエラー ${response.status}`);
        const text = await response.text();
        allData = text.split('\n').filter(l => l.trim()).map(line => parseCSVLine(line));

        initMemberSelect(allData[0]);
        renderGrid(allData); // 初期表示
        message.textContent = "データ読み込み完了";
      } catch (e) {
        showMessage("データの読み込みに失敗しました。\n" + e.message);
      }
    }

    // メンバー選択リスト生成
    function initMemberSelect(headerLine) {
      const members = headerLine.slice(1);
      memberSelect.innerHTML = members.map(m => `<option value="${m}">${m}</option>`).join('');
    }

    // メンバー表示切替
